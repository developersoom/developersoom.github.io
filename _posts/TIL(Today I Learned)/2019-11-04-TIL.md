---
layout: post
title: 191104 TIL MobX 6.X with React Hooks
category: TIL (Today I Learned)
permalink: /til/:year/:month/:day/:title/
tags: [TIL]
comments: true
---

## ì˜¤ëŠ˜ í•  ì¼ ##
1. React Hooks + MobX + TS ë³µìŠµ 

---

Reactë¥¼ í•¨ìˆ˜í˜•ìœ¼ë¡œ ì“°ê³  ì‹¶ì€ë°, ê·¸ëŸ¬ë©´ `mobx-react-lite` ì¨ì•¼í•œë‹¤ê³  í•œë‹¤.  
ê·¸ë˜ì„œ ë§‰ ì¨ë³´ê³  ìˆëŠ”ë°, ë˜ mobx ë²„ì ¼ 6.xx ì´ìƒì€ ê·¸ëƒ¥ `mobx-react`ë¥¼ ì¨ë„ ëœë‹¤ê³  í•œë‹¤. í•˜í•³ 

[Using MobX with React Hooks and TypeScript](https://blog.mselee.com/posts/2019/06/08/using-mobx-with-react-hooks-typescript/) 
ì´ tutorialì„ ì°¬ì°¬íˆ ë‹¤ì‹œ ë”°ë¼í•´ë³´ëŠ” ì¤‘... 

---

```js

//city.tsx  
import React from 'react';

export const CityView: React.FC<{ cities: string[] }> = ({cities}) => {
    return (
        <ul>
            {cities.map(city => <li>{city}</li>)}
        </ul>
    );
}

export const CityList = () => {
    return <CityView cities={[]} />
}

export default CityList;

// store.ts
const Cities = [
    'London', 'Seoul', 'LA'
];

export const createStore = () => {
    const store = {
        get allCities() {
            return Cities;
        }
    };

    return store;
};

export type TStore = ReturnType<typeof createStore>

// context.tsx 
import React from 'react';
import { useLocalStore } from 'mobx-react';
import { createStore, TStore } from "./store/store";

export const storeContext = React.createContext<TStore | null>(null);

export const StoreProvider: React.FC = ({children}) => {
    const store = useLocalStore(createStore);

    return (
        <storeContext.Provider value={store}>
            {children}
        </storeContext.Provider>
    );
};

export default StoreProvider;
```

`storeContext`ë¥¼ ì½˜ì†”ì— ì°ì–´ë³´ë©´ ì•„ë˜ì²˜ëŸ¼ ë‚˜ì˜¨ë‹¤. 

```js
$$typeof: Symbol(react.context)
Consumer: {$$typeof: Symbol(react.context), _context: {â€¦}, _calculateChangedBits: null, â€¦}
Provider: {$$typeof: Symbol(react.provider), _context: {â€¦}}
_calculateChangedBits: null
_currentRenderer: {}
_currentRenderer2: null
_currentValue: null
_currentValue2: null
_threadCount: 0
__proto__: Object
```

[ë¦¬ì•¡íŠ¸ 16.3 ì— ì†Œê°œëœ ìƒˆë¡œì›Œì§„ Context API íŒŒí—¤ì¹˜ê¸°](https://velopert.com/3606) ì´ ê¸€ì„ ë³´ë©´ ì•„ë˜ì²˜ëŸ¼ contextë¥¼ ì„¤ëª…í•œë‹¤. 

`Context ëŠ” createContext ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ë§Œë“¤ë©°, 
ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ Provider ì™€ Consumer ë¼ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì´ ë°˜í™˜ë©ë‹ˆë‹¤. 
Provider ëŠ” Context ì—ì„œ ì‚¬ìš© í•  ê°’ì„ ì„¤ì •í•  ë•Œ ì‚¬ìš©ë˜ê³ , 
Consumer ëŠ” ë‚˜ì¤‘ì— ìš°ë¦¬ê°€ ì„¤ì •í•œ ê°’ì„ ë¶ˆëŸ¬ì™€ì•¼ í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.`

ì •ë¦¬í•˜ë©´,,,
1. storeì—ëŠ” initial valuesì™€ ì‚¬ìš©í•  í•¨ìˆ˜ë¥¼ ì„ ì–¸í•˜ì—¬ export
2. contextì—ì„œëŠ” 
    1) Contextì™€ Providerë¥¼ ë§Œë“¤ì–´ì„œ export
    2) Contextì—ì„œëŠ” ì‚¬ìš©í•  storeë¥¼ ë¶ˆëŸ¬ì˜¤ê³ ,
    3) Providerì—ì„œëŠ” store ë¶ˆëŸ¬ì™€ì„œ ì´ storeë¥¼ Providerì— ë„£ì–´ì¤€ë‹¤... 
    
    ? ì§ˆë¬¸ ? 
    - StoreProviderì—ì„œ createStoreí•˜ëŠ”ë°, storeContext í•„ìš”í•œ ì´ìœ ëŠ”?
    - mobx `useLocalStore` ì—­í• ? 
    
    ~~í›„ì‰ MobX ë‹¤ì‹œ ê³µë¶€í•´ì•¼ë¼.~~

---
    
#### `useLocalStore`
[https://mobx-react.js.org/state-local](https://mobx-react.js.org/state-local)

`useLocalStore<T, S>(initializer: () => T, source?: S): T`  

Local observable state can be introduced by using the useLocalStore hook, 
that runs its initializer function once to create an observable store and 
keeps it around for a lifetime of a component.

ë¡œì»¬ observable stateëŠ” `useLocalStore` hookì„ ì‚¬ìš©í•´ ì†Œê°œë  ìˆ˜ ìˆë‹¤. 
`useLocalStore`ëŠ” initializer í•¨ìˆ˜ë¥¼ í•œë²ˆ ì‹¤í–‰ì‹œí‚¤ëŠ”ë°, observable storeë¥¼ ìƒì„±í•˜ê³ , ì»´í¬ë„ŒíŠ¸ì˜ lifetime ë™ì•ˆ ìœ ì§€í•œë‹¤. 

All properties of the returned object will be made observable automatically, 
getters will be turned into computed properties, and 
methods will be bound to the store and apply mobx transactions automatically. 
If new class instances are returned from the initializer, they will be kept as is.

returnëœ ê°ì²´ì˜ ëª¨ë“  propertyëŠ” ìë™ì ìœ¼ë¡œ observableë  ìˆ˜ ìˆë‹¤. 
getterëŠ” computed propertyë¡œ ë³€í•  ê²ƒì´ê³ , 
methodëŠ” storeì— bindë  ê²ƒì´ë©° mobx transactionì„ ìë™ì ìœ¼ë¡œ ì ìš©í•  ê²ƒì´ë‹¤. 
ë§Œì•½ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ê°€ initializerì—ì„œ ë°˜í™˜ë˜ë©´, ê·¸ ì¸ìŠ¤í„´ìŠ¤ëŠ” ê·¸ ìƒíƒœë¡œ ìœ ì§€ë  ê²ƒì´ë‹¤. 


```js

import React from 'react'
import { useLocalStore, useObserver } from 'mobx-react' // 6.x

export const SmartTodo = () => {
    const todo = useLocalStore(() => ({
        title: 'Click to toggle',
        done: false,
        toggle() {
            todo.done = !todo.done
        },
        get emoji() {
            return todo.done ? 'ğŸ˜œ' : 'ğŸƒ'
        },
    }))

    return useObserver(() => (
        <h3 onClick={todo.toggle}>
            {todo.title} {todo.emoji}
        </h3>
    ))
}
```

~~ì‹¤ì œ LocalStorageë¥¼ ì“°ì§€ëŠ” ì•ŠëŠ”êµ°...~~

---

```js

// city.tsx
import React from 'react';
import { useObserver } from 'mobx-react';
import { storeContext } from "../context";

export const CityView: React.FC<{ cities: string[] }> = ({cities}) => {
    return (
        <ul>
            {cities.map(city => <li>{city}</li>)}
        </ul>
    );
}

export const CityList = () => {
    const store = React.useContext(storeContext);
    if (!store) throw Error('Store is NULL');
    
    return useObserver(() => {
        return <CityView cities={store.allCities}/>
    })
}

export default CityList;
```

ë°”ë¡œ ë‹¤ìŒ ë‹¨ê³„ì— ë‚˜ì˜´.. 

`Each component is now place, but we are rendering a hardcoded empty list. 
Letâ€™s connect the <CityList /> component to our store. 
We will access the store instance in <StoreProvider /> via the React.useContext hook`

---

ì˜ˆì œì—ëŠ” ì—†ì§€ë§Œ city ì¶”ê°€í•˜ëŠ” ê±¸ ë§Œë“¤ì–´ë³´ê² ì–´.

```js

//store.ts
import {observable} from "mobx";

const Cities = observable([
    'London', 'Seoul', 'LA'
]);

export const createStore = () => {
    const store = {
        city: observable.box(''),
        setCity(city: string) {
            store.city.set(city);
        },
        addCity() {
            Cities.push(store.city.get());
        },
    };
    return store;
};

export type TStore = ReturnType<typeof createStore>

//createCity.tsx 
import React from 'react';
import { useObserver } from 'mobx-react'
import { storeContext } from "../context";

const Create: React.FC = () => {
    const store = React.useContext(storeContext);
    if (!store) throw Error('store is null');

    const {city, setCity} = store;
    return useObserver(() => {
        return (
            <div>
                <input value={city.get()} onChange={e => setCity(e.target.value)}/>
                <button onClick={store.addCity}>ì¶”ê°€</button>
            </div>
        )
    });
}

export default Create
```


ë˜ê¸´ ë˜ëŠ”ë°, ì´ê²Œ ë§ëŠ”ì§€ ëª¨ë¥´ê² ë‹¤ ì—‰ì—‰ ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ 